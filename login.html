<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Wellness Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 50%, #a5d6a7 100%);
      background-attachment: fixed;
    }

    .wellness-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .gradient-text {
      background: linear-gradient(135deg, #66bb6a 0%, #4caf50 50%, #43a047 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .gradient-btn {
      background: linear-gradient(135deg, #66bb6a 0%, #4caf50 50%, #43a047 100%);
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 187, 106, 0.3);
    }

    .gradient-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 187, 106, 0.4);
    }

    .input-field {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(102, 187, 106, 0.3);
      transition: all 0.3s ease;
    }

    .input-field:focus {
      border-color: #66bb6a;
      box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.2);
    }

    .wellness-icon {
      color: #66bb6a;
      text-shadow: 0 2px 5px rgba(102, 187, 106, 0.3);
    }

    .google-btn {
      border: 1px solid #dddddd;
      transition: all 0.3s ease;
    }

    .google-btn:hover {
      border-color: #66bb6a;
      box-shadow: 0 2px 8px rgba(102, 187, 106, 0.2);
    }

    .toggle-btn {
      color: #4caf50;
      transition: all 0.3s ease;
    }

    .toggle-btn:hover {
      color: #388e3c;
    }

    .wellness-symbol {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">
  <div class="wellness-card w-full max-w-md p-8">
    <!-- Wellness Symbols -->
    <div class="text-center mb-4">
      <div class="wellness-symbol">
        <i class="fas fa-heart wellness-icon"></i>
        <i class="fas fa-brain wellness-icon mx-2"></i>
        <i class="fas fa-seedling wellness-icon"></i>
      </div>
      <h1 class="text-3xl font-bold gradient-text">Student Wellness Hub</h1>
      <p class="text-gray-600 mt-2">Your path to mental wellness begins here</p>
    </div>

    <h2 id="form-title" class="text-2xl font-bold text-center mb-6">Login to Your Account</h2>

    <!-- Email/Password Form -->
    <form id="auth-form" class="space-y-4">
      <div id="name-field" class="hidden">
        <div class="flex items-center mb-1">
          <i class="fas fa-user wellness-icon mr-2"></i>
          <label for="fullname" class="text-gray-700">Full Name</label>
        </div>
        <input type="text" id="fullname" placeholder="Enter your full name"
          class="w-full input-field rounded-lg px-4 py-3" />
      </div>

      <div>
        <div class="flex items-center mb-1">
          <i class="fas fa-envelope wellness-icon mr-2"></i>
          <label for="email" class="text-gray-700">Email Address</label>
        </div>
        <input type="email" id="email" placeholder="Enter your email" class="w-full input-field rounded-lg px-4 py-3"
          required />
      </div>

      <div>
        <div class="flex items-center mb-1">
          <i class="fas fa-lock wellness-icon mr-2"></i>
          <label for="password" class="text-gray-700">Password</label>
        </div>
        <input type="password" id="password" placeholder="Enter your password"
          class="w-full input-field rounded-lg px-4 py-3" required />
      </div>

      <button type="submit" class="w-full gradient-btn text-white font-semibold px-4 py-3 rounded-lg">
        <i class="fas fa-sign-in-alt mr-2"></i>
        <span id="submit-text">Login</span>
      </button>
    </form>

    <!-- Divider -->
    <div class="flex items-center gap-2 my-6">
      <div class="flex-1 h-px bg-gray-300"></div>
      <span class="text-sm text-gray-500">OR</span>
      <div class="flex-1 h-px bg-gray-300"></div>
    </div>

    <!-- Google Sign-in Button -->
    <div class="flex justify-center">
      <div class="g_id_signin google-btn p-2 rounded-lg" data-type="standard" data-shape="rectangular"
        data-theme="outline" data-text="signin_with" data-size="large" data-logo_alignment="left" data-width="300">
      </div>
    </div>

    <!-- Toggle -->
    <p class="text-center text-sm text-gray-600 mt-6">
      <span id="toggle-text">Don't have an account?</span>
      <button id="toggle-btn" class="toggle-btn font-semibold ml-1">Sign Up</button>
    </p>
  </div>

  <!-- Google OAuth Setup -->
  <div id="g_id_onload" data-client_id="1048202385042-7i062mlgj5n2ku5pl2p8mo7o9j8j94kv.apps.googleusercontent.com"
    data-context="signin" data-ux_mode="popup" data-callback="handleGoogleCredential" data-auto_prompt="false">
  </div>

  <script>
    const SUPABASE_URL = "https://inazfbeskwidifegofww.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImluYXpmYmVza3dpZGlmZWdvZnd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3Nzg5MDUsImV4cCI6MjA3NDM1NDkwNX0.dXYT9tSQnrNilOEKKkUXwiqO7Zdfg8FmqYh_9eLqN1I";
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById("auth-form");
    const toggleBtn = document.getElementById("toggle-btn");
    const formTitle = document.getElementById("form-title");
    const nameField = document.getElementById("name-field");
    const submitText = document.getElementById("submit-text");
    const toggleText = document.getElementById("toggle-text");
    let isLogin = true;

    toggleBtn.addEventListener("click", () => {
      isLogin = !isLogin;
      formTitle.textContent = isLogin ? "Login to Your Account" : "Create Your Account";
      submitText.textContent = isLogin ? "Login" : "Sign Up";
      toggleBtn.textContent = isLogin ? "Sign Up" : "Login";
      toggleText.textContent = isLogin ? "Don't have an account?" : "Already have an account?";
      nameField.classList.toggle("hidden", isLogin);
    });

    // Email/password signup/login
    // Email/password signup/login
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const fullname = document.getElementById("fullname").value.trim();

      try {
        if (isLogin) {
          // ðŸ”¹ LOGIN
          const { data, error } = await supabaseClient.auth.signInWithPassword({
            email,
            password
          });
          if (error) throw error;
        } else {
          // ðŸ”¹ SIGNUP
          const { data, error } = await supabaseClient.auth.signUp({
            email,
            password,
            options: {
              data: { full_name: fullname } // metadata stored in auth.users
            }
          });
          if (error) throw error;
        }

        // Store locally & redirect
        localStorage.setItem("user_email", email);
        window.location.href = "dashboard.html";
      } catch (err) {
        console.error(err);
        alert(err.message);
      }
    });


    // Google login callback
    async function handleGoogleCredential(response) {
      try {
        const jwt = response.credential;
        const payload = JSON.parse(atob(jwt.split(".")[1]));
        const email = payload.email;
        const full_name = payload.name;
        const google_id = payload.sub;
        const avatar_url = payload.picture;

        await supabaseClient.from("users").upsert(
          { email, full_name, avatar_url, provider: "google", google_id },
          { onConflict: "email" } // prevents duplicates
        );

        localStorage.setItem("user_email", email);
        window.location.href = "dashboard.html";
      } catch (err) {
        console.error(err);
        alert("Google login failed: " + err.message);
      }
    }
  </script>
</body>

</html>